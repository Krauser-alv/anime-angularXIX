<div class="flex flex-col mt-5 items-start bg-white dark:bg-gray-800 shadow-lg rounded-2xl overflow-hidden transform transition-transform hover:scale-105 w-full cursor-pointer"
     (click)="navigateToAnime()">
    <div class="relative w-full h-64">
        <!-- Imagen del episodio o placeholder -->
        @if (episodeImage() && !imageError()) {
            <img 
                class="w-full h-full object-cover select-none transition-transform duration-400 hover:scale-110"
                loading="lazy" 
                [src]="episodeImage()" 
                [alt]="episode().title"
                (error)="onImageError()">
        } @else {
            <!-- Placeholder SVG cuando no hay imagen -->
            <div class="w-full h-full bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center">
                <svg class="w-20 h-20 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
            </div>
        }
        
        <!-- Badge del tipo de episodio -->
        <div class="absolute top-2 right-2 px-2.5 py-1.5 rounded-full text-white text-sm font-bold" [ngClass]="episodeTypeClass()">
            {{ episodeTypeLabel() }}
        </div>

        <!-- Badge del número de episodio -->
        <div class="absolute top-2 left-2 bg-black bg-opacity-70 text-white px-2.5 py-1.5 rounded-full text-sm font-bold">
            T{{ episode().season_number }} E{{ episode().episode_number }}
        </div>

        <!-- Información del episodio -->
        <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white p-3">
            <a [title]="episode().title" class="font-bold text-lg hover:text-blue-400 line-clamp-1">
                {{ episode().title }}
            </a>
            
            <div class="flex items-center justify-between mt-1">
                <!-- Rating con componente de estrellas -->
                @if (episode().vote_average && episode().vote_average !== '0') {
                    <app-star-rating
                        [rating]="normalizedRating"
                        [totalVotes]="voteCount"
                        [size]="'small'"
                        [interactive]="false"
                        [showRatingText]="true"
                    ></app-star-rating>
                }
                
                <!-- Runtime -->
                @if (episode().runtime && episode().runtime !== '') {
                    <span class="text-sm text-gray-300">{{ episode().runtime }} min</span>
                }
            </div>
        </div>
    </div>
</div>
